# Our Tank（好友鱼缸）需求文档

## 简介

Our Tank 是一个熟人社交功能，允许用户创建私密鱼缸并邀请好友加入。每个成员可以将自己画的鱼添加到共享鱼缸中，鱼之间可以进行群聊互动，所有成员都能看到聊天内容，类似微信群聊的体验。

## 功能定位

- **轻型熟人社交**：不是陌生人社交，而是朋友圈子的私密互动空间
- **异步互动**：成员不需要同时在线，鱼会自动聊天，成员随时可以查看
- **创意表达**：通过自己画的鱼来代表自己，增加趣味性和个性化

## 术语表

- **Our Tank（好友鱼缸）**: 用户创建的私密共享鱼缸
- **Tank Owner（鱼缸主人）**: 创建鱼缸的用户，拥有管理权限
- **Tank Member（鱼缸成员）**: 加入鱼缸的用户
- **Tank Code（鱼缸邀请码）**: 用于分享和加入鱼缸的唯一标识
- **Tank Password（鱼缸密码）**: 可选的加入密码，增加私密性

## 需求列表

### 需求 1：创建好友鱼缸

**用户故事:** 作为用户，我希望能创建一个好友鱼缸并设置基本信息，以便邀请朋友一起玩。

#### 验收标准

1. WHEN 用户点击创建好友鱼缸 THEN 系统 SHALL 显示创建表单，包含鱼缸名称、描述、是否需要密码等选项
2. WHEN 用户提交创建表单 THEN 系统 SHALL 生成唯一的鱼缸邀请码并创建鱼缸记录
3. WHEN 用户设置了密码 THEN 系统 SHALL 加密存储密码，加入时需要验证
4. WHEN 用户创建鱼缸数量达到会员限制 THEN 系统 SHALL 提示升级会员以创建更多鱼缸
5. WHEN 鱼缸创建成功 THEN 系统 SHALL 自动将创建者设为鱼缸主人并加入成员列表

### 需求 2：分享和加入好友鱼缸

**用户故事:** 作为鱼缸主人，我希望能分享邀请链接给朋友，让他们轻松加入我的鱼缸。

#### 验收标准

1. WHEN 鱼缸主人点击分享 THEN 系统 SHALL 生成包含鱼缸邀请码的链接（如 ?tank=CODE）
2. WHEN 用户通过邀请链接访问 THEN 系统 SHALL 显示鱼缸预览信息和加入按钮
3. WHEN 鱼缸设有密码且用户点击加入 THEN 系统 SHALL 要求输入密码验证
4. WHEN 密码验证通过或无密码鱼缸 THEN 系统 SHALL 将用户添加为鱼缸成员
5. WHEN 用户已是成员再次访问邀请链接 THEN 系统 SHALL 直接进入鱼缸页面

### 需求 3：管理鱼缸中的鱼

**用户故事:** 作为鱼缸成员，我希望能将自己画的鱼添加到好友鱼缸中，与朋友的鱼一起游泳。

#### 验收标准

1. WHEN 成员在好友鱼缸页面点击添加鱼 THEN 系统 SHALL 显示该用户已画的鱼列表供选择
2. WHEN 成员选择鱼并确认添加 THEN 系统 SHALL 将鱼添加到该好友鱼缸
3. WHEN 成员想移除自己的鱼 THEN 系统 SHALL 允许移除，但不影响原始鱼数据
4. WHEN 一条鱼已在某好友鱼缸中 THEN 系统 SHALL 在选择列表中标记已添加状态
5. WHEN 好友鱼缸中的鱼数量达到上限 THEN 系统 SHALL 提示无法添加更多鱼

### 需求 4：好友鱼缸群聊

**用户故事:** 作为鱼缸成员，我希望看到鱼缸中所有鱼的群聊对话，就像微信群聊一样。

#### 验收标准

1. WHEN 好友鱼缸中有多条鱼 THEN 系统 SHALL 定期触发 AI 群聊，鱼之间自动对话
2. WHEN 群聊发生 THEN 系统 SHALL 保存聊天记录，所有成员都能查看
3. WHEN 成员打开好友鱼缸 THEN 系统 SHALL 显示最近的群聊历史记录
4. WHEN 成员发送消息 THEN 系统 SHALL 将消息显示在群聊中，其他成员可见
5. WHEN 新消息产生 THEN 系统 SHALL 通过实时订阅通知在线成员

### 需求 5：管理好友鱼缸

**用户故事:** 作为鱼缸主人，我希望能管理鱼缸设置和成员，保持鱼缸的良好氛围。

#### 验收标准

1. WHEN 鱼缸主人查看成员列表 THEN 系统 SHALL 显示所有成员及其添加的鱼数量
2. WHEN 鱼缸主人移除某成员 THEN 系统 SHALL 同时移除该成员添加的所有鱼
3. WHEN 鱼缸主人修改鱼缸设置 THEN 系统 SHALL 允许修改名称、描述、密码
4. WHEN 鱼缸主人删除鱼缸 THEN 系统 SHALL 移除所有关联数据并通知成员
5. WHEN 成员主动退出鱼缸 THEN 系统 SHALL 移除该成员及其添加的鱼

### 需求 6：会员权限控制

**用户故事:** 作为产品运营，我希望好友鱼缸功能与会员体系结合，激励用户升级会员。

#### 验收标准

1. WHEN 免费用户创建好友鱼缸 THEN 系统 SHALL 限制最多创建 1 个鱼缸
2. WHEN Plus 会员创建好友鱼缸 THEN 系统 SHALL 限制最多创建 3 个鱼缸
3. WHEN Premium 会员创建好友鱼缸 THEN 系统 SHALL 限制最多创建 10 个鱼缸
4. WHEN 用户查看创建限制 THEN 系统 SHALL 显示当前已创建数量和会员限制
5. WHEN 用户达到限制 THEN 系统 SHALL 显示升级会员的引导

### 需求 7：好友鱼缸列表

**用户故事:** 作为用户，我希望能方便地查看和切换我参与的所有好友鱼缸。

#### 验收标准

1. WHEN 用户访问好友鱼缸入口 THEN 系统 SHALL 显示用户创建的和加入的所有鱼缸列表
2. WHEN 用户点击某个鱼缸 THEN 系统 SHALL 进入该鱼缸的详情页面
3. WHEN 鱼缸有新消息 THEN 系统 SHALL 在列表中显示未读标记
4. WHEN 用户是鱼缸主人 THEN 系统 SHALL 在列表中显示"主人"标识
5. WHEN 鱼缸列表为空 THEN 系统 SHALL 显示创建或加入鱼缸的引导

## 名称建议

除了 "Our Tank"，以下是一些备选名称供参考：

1. **好友鱼缸** - 直白易懂，强调熟人属性
2. **Circle Tank** - 圈子鱼缸，暗示朋友圈
3. **Fish Party** - 鱼派对，强调欢乐氛围
4. **Pond（池塘）** - 比鱼缸更大的概念，暗示群体
5. **Fish Crew** - 鱼群/鱼伙伴，强调团队感
6. **Cozy Tank** - 温馨鱼缸，强调亲密感

推荐使用 **"Our Tank"** 或 **"好友鱼缸"**，简洁明了，用户一看就懂。

## 技术考虑

- 复用现有的 `tank.html` 和 `tank.js` 渲染逻辑，通过 `view=our&tankId=xxx` 参数区分
- 群聊功能复用现有的 Coze AI 群聊系统，扩展支持多用户消息
- 使用 Supabase Realtime 实现消息实时推送
- 鱼缸邀请码使用短码（如 6 位字母数字组合）便于分享
