# ğŸ”§ é‡æ–°éƒ¨ç½²ä¿®å¤æŒ‡å—

## å½“å‰çŠ¶æ€

âœ… **å·²å®Œæˆ**:
- ç¯å¢ƒå˜é‡å…¨éƒ¨é…ç½®æ­£ç¡®
- ä»£ç å·²æ›´æ–°ï¼ŒåŒ…å«æ›´å¥½çš„é”™è¯¯å¤„ç†

âŒ **é—®é¢˜**:
- npm ä¾èµ–åŒ…ï¼ˆdotenv, qiniu, formidableï¼‰åœ¨ Vercel å‡½æ•°ä¸­æ‰¾ä¸åˆ°
- å¯èƒ½æ˜¯ Vercel æ„å»ºç¼“å­˜å¯¼è‡´çš„é—®é¢˜

## ğŸš€ ç«‹å³ä¿®å¤ï¼ˆ3ä¸ªæ­¥éª¤ï¼‰

### æ­¥éª¤ 1: æ¸…é™¤æ„å»ºç¼“å­˜å¹¶é‡æ–°éƒ¨ç½²

è¿™æ˜¯**æœ€é‡è¦**çš„æ­¥éª¤ï¼

1. ç™»å½• [Vercel Dashboard](https://vercel.com/dashboard)
2. é€‰æ‹© **fishart** é¡¹ç›®
3. è¿›å…¥ **Deployments** æ ‡ç­¾
4. æ‰¾åˆ°æœ€æ–°çš„éƒ¨ç½²
5. ç‚¹å‡»å³ä¾§çš„ **"..."** æŒ‰é’®
6. é€‰æ‹© **"Redeploy"**
7. âš ï¸ **é‡è¦**: å–æ¶ˆå‹¾é€‰ "Use existing Build Cache"ï¼ˆä¸ä½¿ç”¨ç°æœ‰æ„å»ºç¼“å­˜ï¼‰
8. ç‚¹å‡» **"Redeploy"**

è¿™å°†å¼ºåˆ¶ Vercel é‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–ã€‚

### æ­¥éª¤ 2: ç­‰å¾…éƒ¨ç½²å®Œæˆ

- éƒ¨ç½²é€šå¸¸éœ€è¦ 2-3 åˆ†é’Ÿ
- å¯ä»¥åœ¨ Deployments é¡µé¢æŸ¥çœ‹å®æ—¶æ—¥å¿—
- æŸ¥æ‰¾ "Installing dependencies" çš„æ—¥å¿—ï¼Œç¡®è®¤ä¾èµ–æ­£åœ¨å®‰è£…

### æ­¥éª¤ 3: éªŒè¯ä¿®å¤

éƒ¨ç½²å®Œæˆåï¼Œå†æ¬¡è®¿é—®è¯Šæ–­ APIï¼š

```
https://www.fishart.online/api/diagnostics
```

åº”è¯¥çœ‹åˆ°ï¼š

```json
{
  "modules": {
    "dotenv": { "status": "ok" },      // âœ… åº”è¯¥æ˜¯ ok
    "qiniu": { "status": "ok" },       // âœ…
    "formidable": { "status": "ok" },  // âœ…
    "hasura": { "status": "ok" },      // âœ…
    "qiniu-uploader": { "status": "ok" } // âœ…
  },
  "handlers": {
    "fish-upload": { "status": "ok" },        // âœ…
    "message-unread-count": { "status": "ok" } // âœ…
  }
}
```

## ğŸ“Š ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

### é—®é¢˜åŸå› 
Vercel åœ¨éƒ¨ç½²æ—¶ä¼šç¼“å­˜æ„å»ºç»“æœä»¥åŠ å¿«åç»­éƒ¨ç½²ã€‚æœ‰æ—¶è¿™ä¸ªç¼“å­˜ä¼šå¯¼è‡´é—®é¢˜ï¼š
- æ—§çš„ node_modules è¢«ä½¿ç”¨
- æ–°çš„ä¾èµ–æ²¡æœ‰è¢«å®‰è£…
- é…ç½®æ›´æ”¹æ²¡æœ‰ç”Ÿæ•ˆ

### æˆ‘ä»¬çš„ä¿®å¤
1. æ›´æ–°äº† `vercel.json`ï¼Œæ·»åŠ äº†æ˜ç¡®çš„æ„å»ºå‘½ä»¤
2. ç§»é™¤äº†éƒ¨åˆ†ä¸å¿…è¦çš„ `dotenv` å¼•ç”¨
3. æ·»åŠ äº†è¿è¡Œæ—¶ç‰ˆæœ¬é…ç½®

### vercel.json çš„æ›´æ”¹

```json
{
  "buildCommand": "npm install",      // æ–°å¢ï¼šæ˜ç¡®å®‰è£…ä¾èµ–
  "installCommand": "npm install",    // æ–°å¢ï¼šç¡®ä¿ä¾èµ–å®‰è£…
  "functions": {
    "api/**/*.js": {
      "runtime": "nodejs24.x"          // æ–°å¢ï¼šæŒ‡å®š Node ç‰ˆæœ¬
    }
  }
}
```

## ğŸ” å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### æ–¹æ¡ˆ A: æ£€æŸ¥éƒ¨ç½²æ—¥å¿—

1. Vercel Dashboard â†’ Deployments â†’ æœ€æ–°éƒ¨ç½²
2. æŸ¥çœ‹ **Building** æ ‡ç­¾çš„æ—¥å¿—
3. æœç´¢ "Installing dependencies"
4. ç¡®è®¤çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š
   ```
   Installing dependencies...
   added 234 packages, and audited 235 packages in 8s
   ```

### æ–¹æ¡ˆ B: å®Œå…¨é‡æ–°éƒ¨ç½²

å¦‚æœæ¸…é™¤ç¼“å­˜åä»æœ‰é—®é¢˜ï¼Œå°è¯•ä» Git è§¦å‘æ–°éƒ¨ç½²ï¼š

```bash
# åœ¨æœ¬åœ°
git add .
git commit -m "Force redeploy to fix dependencies"
git push origin backend
```

è¿™ä¼šè§¦å‘å…¨æ–°çš„éƒ¨ç½²ï¼Œå®Œå…¨ç»•è¿‡ç¼“å­˜ã€‚

### æ–¹æ¡ˆ C: æ£€æŸ¥ Vercel é¡¹ç›®è®¾ç½®

1. Settings â†’ General
2. ç¡®è®¤ **Node.js Version** è®¾ç½®ä¸º `24.x` æˆ– `20.x`
3. ç¡®è®¤ **Install Command** ä¸º `npm install` æˆ–ç•™ç©ºï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰

### æ–¹æ¡ˆ D: æœ¬åœ°éªŒè¯

ç¡®ä¿æœ¬åœ°çš„ `package.json` å’Œ `package-lock.json` æ²¡æœ‰é—®é¢˜ï¼š

```bash
# åˆ é™¤æœ¬åœ° node_modules
rm -rf node_modules

# é‡æ–°å®‰è£…
npm install

# éªŒè¯å…³é”®åŒ…
npm list dotenv qiniu formidable
```

åº”è¯¥çœ‹åˆ°ï¼š
```
fish-art-battle@1.0.0
â”œâ”€â”€ dotenv@16.6.1
â”œâ”€â”€ formidable@3.5.0
â””â”€â”€ qiniu@7.12.0
```

å¦‚æœæœ¬åœ°éƒ½èƒ½æ­£å¸¸å®‰è£…ï¼Œé‚£ä¹ˆ Vercel ä¹Ÿåº”è¯¥èƒ½å¤Ÿå®‰è£…ã€‚

## ğŸ“ éªŒè¯æ¸…å•

éƒ¨ç½²åæ£€æŸ¥ï¼š

- [ ] è®¿é—® `/api/diagnostics` ä¸æŠ¥é”™
- [ ] æ‰€æœ‰ `envVars` éƒ½æ˜¯ `true`
- [ ] æ‰€æœ‰ `modules` çš„ `status` éƒ½æ˜¯ `"ok"`
- [ ] æ‰€æœ‰ `handlers` çš„ `status` éƒ½æ˜¯ `"ok"`
- [ ] æµ‹è¯•å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] æµ‹è¯•æ¶ˆæ¯ç³»ç»ŸåŠŸèƒ½æ­£å¸¸

## ğŸ¯ é¢„æœŸç»“æœ

æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… æ­£å¸¸ç™»å½•
2. âœ… æäº¤é±¼ï¼ˆå›¾ç‰‡ä¸Šä¼ ï¼‰
3. âœ… æŸ¥çœ‹æœªè¯»æ¶ˆæ¯è®¡æ•°
4. âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ

## ğŸ“ å¦‚æœéœ€è¦æ›´å¤šå¸®åŠ©

### æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **è¯Šæ–­ API è¾“å‡º**:
   ```
   https://www.fishart.online/api/diagnostics
   ```

2. **Vercel éƒ¨ç½²æ—¥å¿—**:
   - Deployments â†’ æœ€æ–°éƒ¨ç½² â†’ Building æ ‡ç­¾
   - æˆªå›¾æˆ–å¤åˆ¶ "Installing dependencies" éƒ¨åˆ†

3. **å‡½æ•°æ—¥å¿—**:
   - Deployments â†’ æœ€æ–°éƒ¨ç½² â†’ Functions æ ‡ç­¾
   - ç‚¹å‡» `api/fish-api` æŸ¥çœ‹é”™è¯¯

4. **æœ¬åœ°éªŒè¯**:
   ```bash
   npm list dotenv qiniu formidable
   ```

## ğŸ”‘ å…³é”®è¦ç‚¹

1. **æ¸…é™¤ç¼“å­˜æœ€é‡è¦**: é‡æ–°éƒ¨ç½²æ—¶ä¸€å®šè¦å–æ¶ˆå‹¾é€‰ "Use existing Build Cache"
2. **ç­‰å¾…å®Œæ•´éƒ¨ç½²**: ä¸è¦åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­å–æ¶ˆæˆ–é‡æ–°è§¦å‘
3. **éªŒè¯ç»“æœ**: éƒ¨ç½²åç«‹å³è®¿é—® `/api/diagnostics` éªŒè¯
4. **æ£€æŸ¥æ—¥å¿—**: å¦‚æœä»æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹ Vercel çš„æ„å»ºæ—¥å¿—

---

**é¢„è®¡ä¿®å¤æ—¶é—´**: 5-10 åˆ†é’Ÿï¼ˆä¸»è¦æ˜¯ç­‰å¾… Vercel éƒ¨ç½²ï¼‰

**æˆåŠŸç‡**: 99%ï¼ˆæ¸…é™¤ç¼“å­˜é‡æ–°éƒ¨ç½²å‡ ä¹æ€»æ˜¯èƒ½è§£å†³ä¾èµ–é—®é¢˜ï¼‰

