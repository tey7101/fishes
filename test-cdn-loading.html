<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CDNåŠ è½½æµ‹è¯•</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1a1a1a;
      color: #00ff00;
    }
    .log {
      margin: 5px 0;
      padding: 5px;
      background: #2a2a2a;
      border-left: 3px solid #00ff00;
    }
    .error {
      border-left-color: #ff0000;
      color: #ff6666;
    }
    .success {
      border-left-color: #00ff00;
      color: #00ff00;
    }
    .warning {
      border-left-color: #ffaa00;
      color: #ffaa00;
    }
  </style>
</head>
<body>
  <h1>ğŸ” CDNåŠ è½½è¯Šæ–­å·¥å…·</h1>
  <p>æµ‹è¯•å„ä¸ªCDNæºçš„è¿é€šæ€§...</p>
  <div id="logs"></div>

  <script>
    const logs = document.getElementById('logs');
    
    function log(message, type = 'log') {
      const div = document.createElement('div');
      div.className = 'log ' + type;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logs.appendChild(div);
      console.log(message);
    }

    const cdnSources = [
      { name: 'jsDelivr (å›½é™…)', url: 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js' },
      { name: 'npmmirror (å›½å†…)', url: 'https://registry.npmmirror.com/@supabase/supabase-js/2.39.0/files/dist/umd/supabase.min.js' },
      { name: 'BootCDN (å›½å†…)', url: 'https://cdn.bootcdn.net/ajax/libs/supabase-js/2.39.0/umd/supabase.min.js' },
      { name: 'unpkg (å›½é™…)', url: 'https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.min.js' },
      { name: 'Fastly jsDelivr', url: 'https://fastly.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js' }
    ];

    function testCDN(source, timeout = 8000) {
      return new Promise((resolve) => {
        const startTime = Date.now();
        const script = document.createElement('script');
        script.src = source.url;
        
        const timer = setTimeout(() => {
          script.remove();
          const duration = Date.now() - startTime;
          log(`âŒ ${source.name} - è¶…æ—¶ (${duration}ms)`, 'error');
          resolve({ success: false, duration, error: 'timeout' });
        }, timeout);
        
        script.onload = () => {
          clearTimeout(timer);
          const duration = Date.now() - startTime;
          log(`âœ… ${source.name} - æˆåŠŸ! (${duration}ms)`, 'success');
          script.remove();
          resolve({ success: true, duration });
        };
        
        script.onerror = () => {
          clearTimeout(timer);
          const duration = Date.now() - startTime;
          log(`âŒ ${source.name} - åŠ è½½å¤±è´¥ (${duration}ms)`, 'error');
          script.remove();
          resolve({ success: false, duration, error: 'load_error' });
        };
        
        log(`â³ æµ‹è¯• ${source.name}...`, 'warning');
        document.head.appendChild(script);
      });
    }

    async function runTests() {
      log('å¼€å§‹CDNè¿é€šæ€§æµ‹è¯•...', 'log');
      log('VPNçŠ¶æ€: ' + (navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'), 'log');
      log('User Agent: ' + navigator.userAgent, 'log');
      log('', 'log');
      
      const results = [];
      
      for (const source of cdnSources) {
        const result = await testCDN(source);
        results.push({ ...source, ...result });
        await new Promise(r => setTimeout(r, 500)); // é—´éš”500ms
      }
      
      log('', 'log');
      log('ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»:', 'log');
      const successCount = results.filter(r => r.success).length;
      log(`æˆåŠŸ: ${successCount}/${results.length}`, successCount > 0 ? 'success' : 'error');
      
      if (successCount === 0) {
        log('', 'log');
        log('âš ï¸ æ‰€æœ‰CDNéƒ½æ— æ³•è®¿é—®ï¼Œå¯èƒ½çš„åŸå› :', 'warning');
        log('  1. æµè§ˆå™¨æ‰©å±•é˜»æ­¢äº†è„šæœ¬åŠ è½½ï¼ˆå¹¿å‘Šæ‹¦æˆªå™¨ï¼‰', 'warning');
        log('  2. æµè§ˆå™¨å®‰å…¨è®¾ç½®è¿‡ä¸¥æ ¼', 'warning');
        log('  3. æœ¬åœ°é˜²ç«å¢™æˆ–å®‰å…¨è½¯ä»¶é˜»æ­¢', 'warning');
        log('  4. VPNé…ç½®é—®é¢˜å¯¼è‡´DNSè§£æå¤±è´¥', 'warning');
        log('', 'log');
        log('ğŸ’¡ å»ºè®®æ“ä½œ:', 'warning');
        log('  1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·(F12) -> Networkæ ‡ç­¾', 'warning');
        log('  2. åˆ·æ–°é¡µé¢ï¼ŒæŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯', 'warning');
        log('  3. ä¸´æ—¶ç¦ç”¨æ‰€æœ‰æµè§ˆå™¨æ‰©å±•åé‡è¯•', 'warning');
        log('  4. å°è¯•æ›´æ¢VPNèŠ‚ç‚¹æˆ–æš‚æ—¶å…³é—­VPN', 'warning');
      } else {
        const fastest = results.filter(r => r.success).sort((a, b) => a.duration - b.duration)[0];
        log(`âš¡ æœ€å¿«CDN: ${fastest.name} (${fastest.duration}ms)`, 'success');
      }
    }

    // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æµ‹è¯•
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', runTests);
    } else {
      runTests();
    }
  </script>
</body>
</html>

