# 实现计划

- [x] 1. 创建统计数据 API 处理器



  - [x] 1.1 创建 `lib/api_handlers/admin/analytics.js` 处理器

    - 实现日期区间参数解析
    - 实现用户统计 GraphQL 聚合查询（总数、匿名用户、注册用户）
    - 实现群聊、Our Tank、支付订单的聚合查询
    - 实现按日期分组的时间线数据查询
    - _需求: 2.1, 2.2, 3.1, 4.1, 5.1, 6.1_
  - [x] 1.2 编写属性测试：用户统计一致性


    - **Property 1: 用户统计一致性**
    - **验证: 需求 2.1, 2.2**
  - [x] 1.3 编写属性测试：时间线数据点数量

    - **Property 5: 时间线数据点数量**
    - **验证: 需求 6.1**

- [x] 2. 创建群聊列表 API 处理器


  - [x] 2.1 创建 `lib/api_handlers/admin/chat-list.js` 处理器


    - 实现日期区间过滤查询
    - 实现分页逻辑（limit/offset）
    - 关联查询 our_tanks 获取鱼缸名称
    - 返回群聊基本信息（topic、created_at、参与鱼数量）
    - _需求: 7.1, 7.2, 9.1, 9.2_

  - [x] 2.2 编写属性测试：群聊列表日期过滤

    - **Property 6: 群聊列表日期过滤**
    - **验证: 需求 7.2**

  - [x] 2.3 编写属性测试：群聊列表项完整性
    - **Property 10: 群聊列表项完整性**


    - **验证: 需求 9.1**

- [x] 3. 创建群聊详情 API 处理器

  - [x] 3.1 创建 `lib/api_handlers/admin/chat-detail.js` 处理器

    - 根据 chatId 查询群聊记录
    - 解析 dialogues JSON 字段提取消息列表
    - 按 sequence 排序消息
    - 返回完整对话内容
    - _需求: 7.3, 7.4, 7.5_

  - [x] 3.2 编写属性测试：消息顺序正确性

    - **Property 7: 消息顺序正确性**
    - **验证: 需求 7.4**
  - [x] 3.3 编写属性测试：消息内容完整性

    - **Property 8: 消息内容完整性**

    - **验证: 需求 7.5**


- [x] 4. 扩展 admin-api.js 路由

  - [x] 4.1 在 `api/admin-api.js` 中添加新 action 路由

    - 添加 `analytics` action 路由到 analytics.js
    - 添加 `chat-list` action 路由到 chat-list.js
    - 添加 `chat-detail` action 路由到 chat-detail.js
    - _需求: 1.1, 7.1_


- [ ] 5. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户。

- [x] 6. 创建网站表现页面



  - [x] 6.1 创建 `admin-analytics.html` 页面

    - 添加日期区间选择器（默认24小时）
    - 添加快速选择按钮（7天、30天）
    - 添加统计卡片区域（用户数、群聊数、Our Tank数、订单数）
    - 添加图表容器
    - 添加管理员权限检查
    - _需求: 1.1, 1.2, 1.3, 2.1, 2.2, 3.1, 4.1, 5.1_

  - [x] 6.2 创建 `src/js/admin-analytics.js` 页面逻辑

    - 实现日期区间选择和快速切换
    - 实现统计数据加载和显示
    - 实现加载状态和错误处理
    - 使用 Chart.js 绘制数据曲线图
    - _需求: 1.4, 1.5, 6.1, 6.2, 6.3_



- [x] 7. 创建群聊信息页面

  - [x] 7.1 创建 `admin-chat-viewer.html` 页面

    - 添加日期区间选择器
    - 添加群聊列表容器
    - 添加群聊详情展开区域
    - 添加管理员权限检查
    - _需求: 7.1, 7.2, 9.3_

  - [x] 7.2 创建 `src/js/admin-chat-viewer.js` 页面逻辑

    - 实现群聊列表加载和分页
    - 实现群聊详情展开/折叠
    - 实现聊天气泡样式消息渲染
    - 区分不同鱼的消息颜色
    - 标识用户发言
    - _需求: 7.3, 7.4, 7.5, 8.1, 8.2, 8.3_

  - [ ] 7.3 编写属性测试：用户消息标识
    - **Property 9: 用户消息标识**
    - **验证: 需求 8.3**

- [x] 8. 更新管理中心首页


  - [x] 8.1 在 `admin-center.html` 添加新模块入口卡片


    - 添加网站表现模块卡片（图标、标题、描述、功能标签）
    - 添加群聊信息模块卡片（图标、标题、描述、功能标签）
    - _需求: 10.1, 10.2, 10.3_

- [x] 9. 最终检查点 - 确保所有测试通过


  - 确保所有测试通过，如有问题请询问用户。
