<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢ - FishArt</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-601YXTKK0L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-601YXTKK0L');
    </script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-section h2 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸŸ FishArt è°ƒè¯•å·¥å…·</h1>

    <div class="debug-section">
        <h2>1. ç¯å¢ƒæ£€æµ?/h2>
        <div id="env-status"></div>
    </div>

    <div class="debug-section">
        <h2>2. BACKEND_URL æ£€æµ?/h2>
        <div id="backend-status"></div>
    </div>

    <div class="debug-section">
        <h2>3. ä¾èµ–åº“æ£€æµ?/h2>
        <div id="libs-status"></div>
    </div>

    <div class="debug-section">
        <h2>4. API è¿é€šæ€§æµ‹è¯?/h2>
        <button id="test-backend">æµ‹è¯•åç«¯è¿æ¥</button>
        <div id="api-test-result"></div>
    </div>

    <div class="debug-section">
        <h2>5. æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—</h2>
        <p>è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†æ—¥å¿?/p>
        <div id="console-logs"></div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„è„šæœ?-->
    <script src="/src/js/fish-utils.js"></script>
    
    <script>
        // æ•è·æ§åˆ¶å°æ—¥å¿?
        const logs = [];
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        ['log', 'error', 'warn'].forEach(method => {
            console[method] = function(...args) {
                logs.push({ type: method, message: args.join(' '), time: new Date().toLocaleTimeString() });
                originalConsole[method].apply(console, args);
                updateConsoleLogs();
            };
        });

        function updateConsoleLogs() {
            const logsDiv = document.getElementById('console-logs');
            logsDiv.innerHTML = '<pre>' + logs.map(log => 
                `[${log.time}] [${log.type.toUpperCase()}] ${log.message}`
            ).join('\n') + '</pre>';
        }

        // 1. ç¯å¢ƒæ£€æµ?
        function checkEnvironment() {
            const envDiv = document.getElementById('env-status');
            const hostname = window.location.hostname;
            const isLocal = hostname === 'localhost' || hostname === '127.0.0.1';
            
            envDiv.innerHTML = `
                <div class="status info">
                    <strong>å½“å‰åŸŸåï¼?/strong> <code>${hostname}</code><br>
                    <strong>åè®®ï¼?/strong> <code>${window.location.protocol}</code><br>
                    <strong>ç¯å¢ƒï¼?/strong> <code>${isLocal ? 'æœ¬åœ°å¼€å? : 'ç”Ÿäº§ç¯å¢ƒ'}</code>
                </div>
            `;
        }

        // 2. BACKEND_URL æ£€æµ?
        function checkBackendURL() {
            const backendDiv = document.getElementById('backend-status');
            
            if (typeof window.BACKEND_URL === 'undefined') {
                backendDiv.innerHTML = `
                    <div class="status error">
                        <strong>â?é”™è¯¯ï¼?/strong> <code>window.BACKEND_URL</code> æœªå®šä¹?br>
                        <strong>åŸå› ï¼?/strong> fish-utils.js å¯èƒ½æœªæ­£ç¡®åŠ è½?br>
                        <strong>è§£å†³ï¼?/strong> æ£€æŸ?fish-utils.js æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
                    </div>
                `;
            } else {
                backendDiv.innerHTML = `
                    <div class="status success">
                        <strong>âœ?BACKEND_URL å·²å®šä¹‰ï¼š</strong> <code>${window.BACKEND_URL}</code>
                    </div>
                `;
            }
        }

        // 3. ä¾èµ–åº“æ£€æµ?
        function checkLibraries() {
            const libsDiv = document.getElementById('libs-status');
            const checks = [
                { name: 'Firebase', check: () => typeof firebase !== 'undefined' },
                { name: 'ONNX Runtime', check: () => typeof window.ort !== 'undefined' },
                { name: 'fish-utils.js', check: () => typeof window.BACKEND_URL !== 'undefined' }
            ];

            const results = checks.map(lib => {
                const status = lib.check();
                return `<div class="status ${status ? 'success' : 'error'}">
                    ${status ? 'âœ? : 'â?} ${lib.name}: ${status ? 'å·²åŠ è½? : 'æœªåŠ è½?}
                </div>`;
            });

            libsDiv.innerHTML = results.join('');
        }

        // 4. API è¿é€šæ€§æµ‹è¯?
        document.getElementById('test-backend').addEventListener('click', async function() {
            const button = this;
            const resultDiv = document.getElementById('api-test-result');
            
            button.disabled = true;
            resultDiv.innerHTML = '<div class="status info">â?æ­£åœ¨æµ‹è¯•åç«¯è¿æ¥...</div>';

            try {
                if (typeof window.BACKEND_URL === 'undefined') {
                    throw new Error('BACKEND_URL æœªå®šä¹?);
                }

                console.log('Testing backend URL:', window.BACKEND_URL);
                
                // æµ‹è¯•ä¸€ä¸ªç®€å•çš„ API ç«¯ç‚¹
                const response = await fetch(`${window.BACKEND_URL}/api/fish?limit=1`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <div class="status success">
                            <strong>âœ?åç«¯è¿æ¥æˆåŠŸï¼?/strong><br>
                            çŠ¶æ€ç : ${response.status}<br>
                            å“åº”æ•°æ®: <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('Backend test failed:', error);
                resultDiv.innerHTML = `
                    <div class="status error">
                        <strong>â?åç«¯è¿æ¥å¤±è´¥</strong><br>
                        é”™è¯¯ä¿¡æ¯: <code>${error.message}</code><br>
                        <strong>å¯èƒ½çš„åŸå› ï¼š</strong><br>
                        1. åç«¯æœåŠ¡å™¨æœªå¯åŠ¨æˆ–ä¸å¯è®¿é—?br>
                        2. CORS é…ç½®é—®é¢˜<br>
                        3. ç½‘ç»œè¿æ¥é—®é¢˜<br>
                        4. URL é…ç½®é”™è¯¯
                    </div>
                `;
            } finally {
                button.disabled = false;
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ‰€æœ‰æ£€æŸ?
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Debug page loaded');
            checkEnvironment();
            checkBackendURL();
            checkLibraries();
        });

        // å¦‚æœ fish-utils.js åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯?
        window.addEventListener('error', (e) => {
            if (e.filename && e.filename.includes('fish-utils.js')) {
                document.getElementById('backend-status').innerHTML = `
                    <div class="status error">
                        <strong>â?åŠ è½½å¤±è´¥ï¼?/strong> fish-utils.js æ–‡ä»¶åŠ è½½å¤±è´¥<br>
                        é”™è¯¯: ${e.message}<br>
                        æ–‡ä»¶: ${e.filename}
                    </div>
                `;
            }
        }, true);
    </script>
</body>
</html>


